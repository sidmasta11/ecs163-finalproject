<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Food Trucks in SF</title>
    <script type="text/javascript" src="d3/d3.v4.min.js"></script>
    <script type="text/javascript" src="jquery-3.1.1.js"></script>
    <script src="leaflet/leaflet.js"></script>
    <link rel="stylesheet" href="mapStyleSheet.css">
    <link rel="stylesheet" href="leaflet/leaflet.css">

    <style> /* set the CSS */

    body { font: 12px Arial;}

    path {
        stroke: steelblue;
        stroke-width: 2;
        fill: none;
    }

    .axis path,
    .axis line {
        fill: none;
        stroke: grey;
        stroke-width: 1;
        shape-rendering: crispEdges;
    }

    </style>
</head>

<h1>Exploring Food Trucks in San Francisco!</h1>
<p>By: Siddhanth Sabharwal, 999229332</p>
<p>ECS 163, Project 1: Visual Data Storytelling</p>
<hr>

<body>

<h2>Where are the fusion food trucks located?</h2>

    <div>
    <div class = "ad-left" id="map" style="width: 550px; height: 500px"></div>
    <div class = "ad-right" id="map2" style="width: 550px; height: 500px"></div>
        <div class="clear"></div>
    </div>

    <script>
        // 2d coordinate array and the fields we will store in it
        var coordinateArr = [];
        var field1 = "Applicant";
        var field2 = "Latitude";
        var field3 = "Longitude";
        var field4 = "FoodItems2";

        // import csv file into array
        var i = 0;
        d3.csv('Mobile_Food_Facility_Permit_vis1_ds.csv', function(data){
            data.forEach(function(d){
                // store values in a temp array
                var temp = [];
                temp[0] = d[field1];
                temp[1] = Number(d[field2]);
                temp[2] = Number(d[field3]);
                temp[3] = d[field4];

                // add temp array to coordinate array
                coordinateArr[i] = temp;
                i++;
            });

            // debugging
            //console.log(coordinateArr);
            //console.log(Number(coordinateArr.length));

            // Create variable to hold map element, give initial settings to map
            var map = L.map('map',{ center: [37.7749, -122.4194], zoom: 11});
            var map2 = L.map('map2',{ center: [37.7749, -122.4194], zoom: 11});

            // Add OpenStreetMap tile layer to map element
            L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', { attribution: '© OpenStreetMap' }).addTo(map);
            L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', { attribution: '© OpenStreetMap' }).addTo(map2);

            // Create custom icons
            var myIconBlack = L.icon({
                iconUrl: 'food-truck-icon-black.png',
                iconSize: [38, 95],
            });

            // Add Markers to map
            var coordinateArrLen = coordinateArr.length;
            for (var j = 0; j < coordinateArrLen; j++) {
                var foodType = coordinateArr[j][3]
                // Filtering by Fusion food trucks
                var myDataPoint = L.marker([coordinateArr[j][1], coordinateArr[j][2]], {title: coordinateArr[j][0]}).addTo(map);
                if(foodType == 'Fusion'){
                    var myDataPoint2 = L.marker([coordinateArr[j][1], coordinateArr[j][2]], {title: coordinateArr[j][0]}).addTo(map2);
                }
            }
        });
    </script>

<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

<h3> The left hand side map has markers for ALL food trucks in San Francisco.
    The right hans side map has markers only for the FUSION food trucks in San Francisco.</h3>

<p> The Bay Area is known as a hotbed of multiculturalism, with immigrants from all over the world calling San Francisco their home.
    Many of these immigrants bring their native foods and combine them with what is already here, and thus new fusion dishes like Korean BBQ tacos,
    Chicken Tikka Masala Burritos, and pizzas that taste like burgers become a thing. The question I wanted to answer was what kind of neighborhoods
    in San Francisco are these exotic mixed cusines located? My hypothesis was they would be located more in the Financial District
    and near the Piers where a lot of office workers are and where you would expect to see more immigrants. As the maps clearly show, these fusion food trucks are exclusively located in downtown neighborhoods and away from South and West San Francisco.
    These food trucks are in areas where more immigrants work and where wages can support charging high prices for some of this cuisine.
    <br><br>
    After seeing this chart and seeing the small percentage of fusion food trucks as compared to others,
    I wanted to explore more into what kinds of food trucks get approved, and if the probabilities of getting approved
    depend on the cuisine they serve.
</p>


<hr>
<h2>Are certain kinds of food trucks more likely/less likely to get approved?</h2>

<style>

    .bar {
        fill: steelblue;
    }

    .bar:hover {
        fill: brown;
    }

    .axis--x path {
        display: none;
    }

</style>

<svg width="960" height="500"></svg>
<script>

    var svg = d3.select("svg"),
        margin = {top: 20, right: 20, bottom: 40, left: 50},
        width = +svg.attr("width") - margin.left - margin.right,
        height = +svg.attr("height") - margin.top - margin.bottom;

    var x = d3.scaleBand().rangeRound([0, width]).padding(0.1),
        y = d3.scaleLinear().rangeRound([height, 0]);

    var g = svg.append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    d3.tsv("Mobile_Food_Facility_Permit_vis2_ds.tsv", function(d) {
        d.RejectionRate = +d.RejectionRate;
        return d;
    }, function(error, data) {
        if (error) throw error;

        x.domain(data.map(function(d) { return d.FoodTruckType; }));
        y.domain([0, d3.max(data, function(d) { return d.RejectionRate; })]);

        // Add x axis
        g.append("g")
            .attr("class", "axis axis--x")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x));

        // Text label for the x axis
        svg.append("text")
            .attr("x", width/2)
            .attr("y", height+margin.bottom+10)
            .style("text-anchor", "middle")
            .text("Food Truck Type");

        // Add y axis
        g.append("g")
            .attr("class", "axis axis--y")
            .call(d3.axisLeft(y).ticks(10, "%"))
            .append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 6)
            .attr("dy", "0.71em")
            .attr("text-anchor", "end")
            .text("Frequency");

        // Text label for the y axis
        svg.append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 0-margin.left+50)
            .attr("x", 0-(height / 2))
            .attr("dy", "1em")
            .style("text-anchor", "middle")
            .text("Permit Rejection Rate");

        g.selectAll(".bar")
            .data(data)
            .enter().append("rect")
            .attr("class", "bar")
            .attr("x", function(d) { return x(d.FoodTruckType); })
            .attr("y", function(d) { return y(d.RejectionRate); })
            .attr("width", x.bandwidth())
            .attr("height", function(d) { return height - y(d.RejectionRate);});

    });

</script>

<h3> Over 40% of food truck providers who want to serve authentic cuisine get rejected their first time.</h3>

<p> The question I wanted to answer was whether or not certain kinds of foods are easier to serve out of food trucks. To do this I looked
    at permit approval rates to get a better sense of the data. After recoding the food descriptions to food type groups,
    I started looking at number of approved permits, number of unapproved permits, and number of permits that expired and didn't get
    renewed. I wanted to compare the ratio of approved permits to rejected permits + lapsed permits.
    <br><br>
    My hypothesis was that cold food trucks would be the easiest to implement because the food is pre cooked and pre packaged, and the low rejection rate
    in that category backs this hypothesis up. I also thought that Authentic and Mexican food trucks would have higher rejection rates
    than Fusion food trucks because usually Fusion food trucks make really simple concepts but just with ingredients from multiple
    countries.
    <br><br>
    After seeing this chart and seeing the high rejection rate for authentic food trucks, I wanted to further investigate why so many
    people want to create a specialty business like that versus a cold food truck where you won't have to do any cooking on site and
    thus would be more likely to get permitted. I also want to further investigate the hours of operations these trucks are in operation
    and whether there are interesting times these businesses are open to make more money or serve different markets.
</p>

<hr>
<h2>Are certain kinds of food trucks open at different times?</h2>

<script>

    // append new svg object
    var margin2 = {top: 20, right: 80, bottom: 30, left: 50};
    var bodySelection = d3.select("body");
    var svgSelection = bodySelection.append("svg")
          .attr("width", 1500 - margin2.left - margin2.right)
          .attr("height", 500 - margin2.top - margin2.bottom);
    var gSelection = svgSelection.append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    // our x and y coordinates
    var x2 = d3.scaleBand().rangeRound([0, width]).padding(0.1),
        y2 = d3.scaleLinear().range([height, 0]);
        z = d3.scaleOrdinal(d3.schemeCategory10);

    // line
    var line2 = d3.line()
        .curve(d3.curveBasis)
        .x(function (d) { return x2(d.name); })
        .y(function (d) { return y2(d.value); });

    // colors for our lines
    var color = d3.scaleOrdinal(["#001c9c","#FF0000","#008000", "#000000", "#B87B8C"]);


    d3.csv("Mobile_Food_Facility_Permit_vis3_work_ds.csv", function(error, data) {
        if (error) throw error;

        var labelVar = 'Day';
        var varNames = d3.keys(data[0]).filter(function (key) { return key !== labelVar;});
        color.domain(varNames);

        data.forEach(function(d) {
            d['All'] = +d['All'];
            d['Authentic'] = +d['Authentic'];
            d['ColdTruck'] = +d['ColdTruck'];
            d['Fusion'] = +d['Fusion'];
            d['Mexican'] = +d['Mexican'];
        });

        console.log(data);

        var daysOfWeek = varNames.map(function (name) {
            return {
                name: name,
                values: data.map(function (d) {
                    return {name: d.Day, value: d[name]};
                })
            };
        });
        console.log(daysOfWeek);

        x2.domain(data.map(function(d) { return d.Day; }));
        y2.domain([
        d3.min(daysOfWeek, function(c) { return d3.min(c.values, function(d) { return d.value; }); }),
            d3.max(daysOfWeek, function(c) { return d3.max(c.values, function(d) { return d.value; }); })
        ]);



        z.domain(daysOfWeek.map(function(c) { return c.name; }));

        gSelection.append("g")
            .attr("class", "axis axis--x")
            .attr("transform", "translate(0," - 900 + ")")
            .call(d3.axisBottom(x2));

        gSelection.append("g")
            .attr("class", "axis axis--y")
            .call(d3.axisLeft(y2))
            .append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 6)
            .attr("dy", "0.71em")
            .attr("fill", "#000")
            .text("% Active");

        var dayOfWeek = gSelection.selectAll(".Day")
            .data(daysOfWeek)
            .enter().append("g")
            .attr("class", "day");

        console.log(dayOfWeek);


        dayOfWeek.append("path")
            .attr("class", "line2")
            .attr("d", function(d) { return line2(d.values); })
            .style("stroke", function(d) { return color(d.name); });

        var legend = svgSelection.selectAll(".legend")
            .data(varNames.slice().reverse())
            .enter().append("g")
            .attr("class", "legend")
            .attr("transform", function (d, i) { return "translate(55," + i * 20 + ")"; });

        legend.append("rect")
            .attr("x", 900 - 10)
            .attr("width", 10)
            .attr("height", 10)
            .style("fill", color)
            .style("stroke", "grey");

        legend.append("text")
            .attr("x", 900 - 12)
            .attr("y", 6)
            .attr("dy", ".35em")
            .style("text-anchor", "end")
            .text(function (d) { return d; });

    });

</script>
<h3> Mexican food trucks are open the longest, then followed by cold trucks. Food trucks that serve authentic food
are open for shorter durations.</h3>

<p> The question I wanted to answer was whether or not certain kinds of food trucks are open at different days and why. I wanted
    to answer this question because it could give us more insight into the demand for certain kinds of foods and how
    markets should cater to them. To do this I looked at the days that each food truck was open. After identifying each trucks schedule,
    I aggregated the data and made a stacked line graph with 5 series - 1 for each kind of food truck, and 1 aggregate.
    <br><br>
    My hypothesis was that cold food trucks would be open longest because they serve mostly pre-packaged, pre-cooked food
    that requires very little preparation on site. My hypothesis was correct as cold food trucks are open for the second longest
    duration after Mexican food trucks. A really cool insight here was that people absolutely love Mexican food trucks,
    and that explains why there are so many of them, and why they are open for such long durations. Especially in a city
    like San Francisco, where food costs can be high, some food trucks provide affordable dining options. Also notice how
    nearly every single Mexican food truck in San Francisco operates between Monday-Thursday, whereas food truck drivers in
    other categories take more days off.
    <br><br>
    After this project, I want to further investigate into the scheduling of the trucks and use time open as well as the days open,
    but I couldn't easily finish that for this project. I would've liked to create visualization where the trucks are moving
    along their paths but that would require interactivity.
</p>

</body>


</html>