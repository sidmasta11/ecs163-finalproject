<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Simple markers</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="meteorite.js"></script>
    <style>
        #map {
            height: 100%;
        }

        /* Optional: Makes the sample page fill the window. */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
<div id="map"></div>
<script>
    // file names
    var file1 = "USE_THIS_Meteorite_Landings_MassFilter.csv";

    // pre-processing
    var biggest = [];
    var newfield1 = "name";
    var newfield2 = "id";
    var newfield3 = "nametype";
    var newfield4 = "recclass";
    var newfield5 = "mass";
    var newfield6 = "fall";
    var newfield7 = "year";
    var newfield8 = "reclat";
    var newfield9 = "reclong";
    var markers = [];

    function addmarker(position, t,timeout){
        window.setTimeout(function() {
            //console.log("in here");
            markers.push(new google.maps.Marker({
                position: position,
                setMap: map,
                animation: google.maps.Animation.DROP,
                title: t
            }));
        },1000);
        //console.log("end of addmarker");
    }
    function initMap() {
        // pre-processing loop
        var i = 0;
        d3.csv(file1, function (data) {
            data.forEach(function (meteoriteData) {
                var name = meteoriteData[newfield1];
                var id = Number(meteoriteData[newfield2]);
                var nametype = meteoriteData[newfield3];
                var recclass = meteoriteData[newfield4];
                var mass = Number(meteoriteData[newfield5]);
                var fall = meteoriteData[newfield6];
                var year = Number(meteoriteData[newfield7]);
                var reclat = Number(meteoriteData[newfield8]);
                var reclong = Number(meteoriteData[newfield9]);

                var tempArray2 = [];
                tempArray2[0] = name;
                tempArray2[1] = reclat;
                tempArray2[2] = reclong;
                //{lat: 52.511, lng: 13.447}
                console.log("{lat: ", reclat, ", lng: ", reclong, "}");
                biggest.push(tempArray2);
            });

            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 3,
                center: {lat: 0, lng: 0}
            });

            var maxLength = biggest.length;
            //console.log(biggest[0][1]);
            // plot markers on map
            for (var k = 0; k < maxLength; k++) {
                //console.log(k);
                var position = {lat: biggest[k][1], lng: biggest[k][2]};
                //console.log(biggest[k]);
                var scopeVar = biggest[k];
                window.setTimeout(function(scopeVar) {
                    //console.log(position);
                    markers.push(new google.maps.Marker({
                        position: position,
                        setMap: map,
                        animation: google.maps.Animation.DROP
                        //title: scopeVar[0]
                    }));
                },1000);
                //console.log("after addmarker");
            }
            //console.log(markers.length);
        });
        for (var k = 0; k < biggest.length; k++) {
            //console.log(k);
            var position = {lat: biggest[k][1], lng: biggest[k][2]};
            addmarker(position,biggest[k][0],400);
        }
    }


</script>

<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD_5nzRzli7BUXYEw-cewiS1T8PJOC7o0k&callback=initMap">
</script>
</body>
</html>